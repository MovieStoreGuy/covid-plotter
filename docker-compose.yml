---
version: '3'

services:
  influxdb:
    image: influxdb:2.0.8-alpine
    container_name: influxdb
    volumes:
    - influxdb:/var/lib/influxdb2
    ports: 
    - 8086:8086
    environment:
    - DOCKER_INFLUXDB_INIT_MODE=setup
    - DOCKER_INFLUXDB_INIT_USERNAME=admin
    - DOCKER_INFLUXDB_INIT_PASSWORD=password
    - DOCKER_INFLUXDB_INIT_ORG=covid-19
    - DOCKER_INFLUXDB_INIT_BUCKET=covid-data
    - DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=5iOiu00R7ntYQTE0_egua_LBIzaoJvxYUP62doDjQ4Z1UNmUUlvNjxMa9nBwcP13rhsALBn0clJ9hp_gVKBSYA==
    networks:
    - internal
  grafana:
    image: grafana/grafana:8.1.2-ubuntu
    container_name: grafana
    ports:
    - 3000:3000
    volumes:
    - ./config/grafana.yml:/etc/grafana/provisioning/datasources/influxdb-flux.yml:ro
    environment:
    - INFLUXDB_URL=http://influxdb:8086
    - INFLUXDB_USER=admin
    - INFLUXDB_PASSWORD=password
    - INFLUXDB_DEFAULT_BUCKET=covid-data
    - INFLUXDB_ORG=covid-19
    - INFLUXDB_TOKEN=5iOiu00R7ntYQTE0_egua_LBIzaoJvxYUP62doDjQ4Z1UNmUUlvNjxMa9nBwcP13rhsALBn0clJ9hp_gVKBSYA==
    networks:
    - internal
    depends_on:
    - influxdb


volumes:
  influxdb: {}

networks:
  internal: {}